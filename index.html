<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë°€ ìƒê¸°ë³µë• ë¶„ì„ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8fafc; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); }
        .day-cell { min-height: 100px; transition: all 0.2s; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; }
        .day-cell:hover { background-color: #f1f5f9; cursor: pointer; }
        .good-day { background-color: #ecfdf5; color: #065f46; }
        .bad-day { background-color: #fff1f2; color: #9f1239; }
        .normal-day { background-color: #eff6ff; color: #1e40af; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
        <header class="bg-gradient-to-r from-indigo-700 to-blue-700 p-6 text-white text-center">
            <h1 class="text-2xl font-bold italic">â˜¯ï¸ ì •ë°€ ìƒê¸°ë³µë• ë¶„ì„ê¸°</h1>
            <p class="text-sm opacity-90 mt-2">ë³¸ëª…ê´˜ ê¸°ë°˜ ê¸¸í‰ íŒì • ì‹œìŠ¤í…œ</p>
        </header>

        <main class="p-6 space-y-6">
            <section class="bg-gray-50 p-6 rounded-2xl border border-gray-200">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ì„±ë³„</label>
                        <select id="gender" class="w-full border p-2 rounded bg-white outline-none">
                            <option value="male">ë‚¨ì„±</option>
                            <option value="female">ì—¬ì„±</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ìƒë…„ì›”ì¼ ë° ì‹œê°„</label>
                        <div class="flex gap-1">
                            <input type="date" id="birthDate" class="w-2/3 border p-2 rounded outline-none text-sm">
                            <input type="time" id="birthTime" class="w-1/3 border p-2 rounded outline-none text-sm">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ì–‘ë ¥/ìŒë ¥</label>
                        <select id="calendarType" class="w-full border p-2 rounded bg-white outline-none">
                            <option value="solar">ì–‘ë ¥(Solar)</option>
                            <option value="lunar">ìŒë ¥(Lunar)</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="analyze()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded-xl transition-all shadow-lg">
                            ğŸ“Š ë¶„ì„ ì‹œì‘
                        </button>
                    </div>
                </div>
            </section>

            <section>
                <div class="flex justify-between items-center mb-4 px-2">
                    <div class="flex items-center gap-4">
                        <button onclick="changeMonth(-1)" class="p-2 hover:bg-gray-100 rounded-full transition-colors">â—€</button>
                        <h2 class="text-xl font-bold text-gray-800" id="currentMonthYearDisplay">2026ë…„ 1ì›”</h2>
                        <button onclick="changeMonth(1)" class="p-2 hover:bg-gray-100 rounded-full transition-colors">â–¶</button>
                    </div>
                    <span id="myeongGwaDisplay" class="text-sm font-bold text-indigo-600"></span>
                </div>
                <div class="grid grid-cols-7 text-center font-bold text-gray-500 text-xs mb-2 border-b pb-2">
                    <div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div>
                </div>
                <div id="calendarContainer" class="calendar-grid border-t border-l rounded-lg overflow-hidden border-gray-200"></div>
            </section>

            <section id="analysisResult" class="hidden bg-white border-2 border-indigo-100 p-6 rounded-2xl shadow-sm">
                <div id="reportContent"></div>
            </section>
        </main>
    </div>

    <script>
        let isAnalyzed = false;
        let userData = { myeongGwa: 1 };
        let viewDate = new Date(2026, 0, 1); // í˜„ì¬ ë‹¬ë ¥ ë³´ê¸° ê¸°ì¤€ì¼

        const saengGiTable = {
            1: { 'ë¶': 'ë³µë•', 'ë¶ë™': 'ê·€í˜¼', 'ë™': 'ì²œì˜', 'ë‚¨ë™': 'ìƒê¸°', 'ë‚¨': 'ìœ í˜¼', 'ë‚¨ì„œ': 'ì ˆì²´', 'ì„œ': 'í™”í•´', 'ë¶ì„œ': 'ì ˆëª…' },
            2: { 'ë¶': 'ì ˆëª…', 'ë¶ë™': 'ìƒê¸°', 'ë™': 'í™”í•´', 'ë‚¨ë™': 'ì ˆì²´', 'ë‚¨': 'ê·€í˜¼', 'ë‚¨ì„œ': 'ë³µë•', 'ì„œ': 'ì²œì˜', 'ë¶ì„œ': 'ìœ í˜¼' },
            3: { 'ë¶': 'ìƒê¸°', 'ë¶ë™': 'í™”í•´', 'ë™': 'ë³µë•', 'ë‚¨ë™': 'ìœ í˜¼', 'ë‚¨': 'ì²œì˜', 'ë‚¨ì„œ': 'ì ˆëª…', 'ì„œ': 'ì ˆì²´', 'ë¶ì„œ': 'ê·€í˜¼' },
            4: { 'ë¶': 'ì²œì˜', 'ë¶ë™': 'ì ˆì²´', 'ë™': 'ìœ í˜¼', 'ë‚¨ë™': 'ë³µë•', 'ë‚¨': 'ìƒê¸°', 'ë‚¨ì„œ': 'ê·€í˜¼', 'ì„œ': 'ì ˆëª…', 'ë¶ì„œ': 'í™”í•´' },
            6: { 'ë¶': 'ê·€í˜¼', 'ë¶ë™': 'ì²œì˜', 'ë™': 'ì ˆëª…', 'ë‚¨ë™': 'í™”í•´', 'ë‚¨': 'ì ˆì²´', 'ë‚¨ì„œ': 'ìœ í˜¼', 'ì„œ': 'ìƒê¸°', 'ë¶ì„œ': 'ë³µë•' },
            7: { 'ë¶': 'í™”í•´', 'ë¶ë™': 'ì ˆëª…', 'ë™': 'ì ˆì²´', 'ë‚¨ë™': 'ê·€í˜¼', 'ë‚¨': 'ìœ í˜¼', 'ë‚¨ì„œ': 'ì²œì˜', 'ì„œ': 'ë³µë•', 'ë¶ì„œ': 'ìƒê¸°' },
            8: { 'ë¶': 'ìœ í˜¼', 'ë¶ë™': 'ë³µë•', 'ë™': 'ì ˆëª…', 'ë‚¨ë™': 'ì ˆì²´', 'ë‚¨': 'í™”í•´', 'ë‚¨ì„œ': 'ìƒê¸°', 'ì„œ': 'ê·€í˜¼', 'ë¶ì„œ': 'ì²œì˜' },
            9: { 'ë¶': 'ì ˆì²´', 'ë¶ë™': 'ìœ í˜¼', 'ë™': 'ìƒê¸°', 'ë‚¨ë™': 'ì²œì˜', 'ë‚¨': 'ë³µë•', 'ë‚¨ì„œ': 'í™”í•´', 'ì„œ': 'ì ˆëª…', 'ë¶ì„œ': 'ê·€í˜¼' }
        };

        const aiExplainBase = {
            'ìƒê¸°': { summary: "ì „ë°˜ì ì¸ ê¸°ìš´ì´ ê°€ì¥ ê°•í•œ ëŒ€ê¸¸ì¼ì…ë‹ˆë‹¤.", action: ["ì‹œì‘", "í™•ì¥", "ê²°ì •"], avoid: [], recommend: "ê²°í˜¼, ê°œì—…, ì´ì‚¬, ê³„ì•½" },
            'ì²œì˜': { summary: "ê·€ì¸ì˜ ë„ì›€ê³¼ íšŒë³µ ìš´ì´ ë”°ë¥´ëŠ” ë‚ ì…ë‹ˆë‹¤.", action: ["ì¹˜ìœ ", "ìƒë‹´", "ì •ë¦¬"], avoid: ["ë¬´ë¦¬í•œ í™•ì¥"], recommend: "ë³‘ì› ë°©ë¬¸, í˜‘ìƒ, ë¬¸ì œ í•´ê²°" },
            'ë³µë•': { summary: "ì¬ë¬¼ê³¼ ì¸ê°„ê´€ê³„ì˜ ì¡°í™”ê°€ ì¢‹ì€ ë‚ ì…ë‹ˆë‹¤.", action: ["ë§Œë‚¨", "ì¬ì •", "í˜‘ì—…"], avoid: [], recommend: "ê¸ˆì „ ê±°ë˜, ê°€ì¡± í–‰ì‚¬" },
            'ìœ í˜¼': { summary: "ì§‘ì¤‘ë ¥ì´ ííŠ¸ëŸ¬ì§€ê¸° ì‰¬ìš´ í‰ë²”í•œ ë‚ ì…ë‹ˆë‹¤.", action: ["ì¼ìƒ ìœ ì§€"], avoid: ["ì¤‘ìš” ê²°ì •"], recommend: "ë£¨í‹´ ì—…ë¬´, ë‹¨ìˆœ ì‚¬ë¬´" },
            'ê·€í˜¼': { summary: "ë§ˆë¬´ë¦¬ì™€ ì •ë¦¬ì— ì í•©í•œ ë‚ ì…ë‹ˆë‹¤.", action: ["ì •ë¦¬", "ë³µê¸°"], avoid: ["ìƒˆ ì¶œë°œ"], recommend: "ì •ì‚°, íšŒê³ , ì§‘ì•ˆ ì •ë¦¬" },
            'í™”í•´': { summary: "êµ¬ì„¤ì´ë‚˜ ì¶©ëŒì´ ë°œìƒí•˜ê¸° ì‰¬ìš´ í‰ì¼ì…ë‹ˆë‹¤.", action: [], avoid: ["ëŒ€ë©´", "ê³„ì•½"], recommend: "ì™¸ì¶œ ìì œ, ë…ì„œ, ëª…ìƒ" },
            'ì ˆì²´': { summary: "ê¸°ìš´ì´ ë§‰í˜€ ì§„í–‰ì´ ì–´ë ¤ìš´ ë‚ ì…ë‹ˆë‹¤.", action: [], avoid: ["íˆ¬ì", "ì´ë™"], recommend: "íœ´ì‹, ì •ì  í™œë™" },
            'ì ˆëª…': { summary: "ê°€ì¥ ê°•í•œ ëŒ€í‰ì¼ë¡œ ëª¨ë“  ê²°ì •ì´ ë¶ˆë¦¬í•©ë‹ˆë‹¤.", action: [], avoid: ["ëª¨ë“  ì¤‘ìš” í™œë™"], recommend: "ì •ì ì¸ ìƒí™œ, ê¸°ë„, ììˆ™" }
        };

        function getUserBaseInfo() {
            const birth = document.getElementById('birthDate').value;
            const gender = document.getElementById('gender').value;
            const calendarType = document.getElementById('calendarType').value;
            
            if (!birth) return null;

            const year = new Date(birth).getFullYear();
            let sum = String(year).split('').reduce((acc, curr) => acc + parseInt(curr), 0);
            let remainder = sum % 9;
            if (remainder === 0) remainder = 9;

            let myeongGwa;
            if (gender === 'male') {
                myeongGwa = 11 - remainder;
                if (myeongGwa > 9) myeongGwa -= 9;
            } else {
                myeongGwa = 4 + remainder;
                if (myeongGwa > 9) myeongGwa -= 9;
            }

            if (myeongGwa === 5) {
                myeongGwa = (gender === 'male') ? 2 : 8;
            }

            return { myeongGwa, year, gender, calendarType };
        }

        function getDayDirection(date) {
            const directions = ['ë¶','ë¶ë™','ë™','ë‚¨ë™','ë‚¨','ë‚¨ì„œ','ì„œ','ë¶ì„œ'];
            // ì ˆëŒ€ ë‚ ì§œ ê¸°ë°˜ ê³„ì‚° (ì—°ì›”ì¼ í•©ì‚° ê¸°ë°˜ì˜ ì˜ì‚¬ ëœë¤ ë°©í–¥ì„±)
            const seed = date.getFullYear() + date.getMonth() + date.getDate();
            return directions[seed % 8];
        }

        function matchSaengGi(myeongGwa, direction) {
            if (!saengGiTable[myeongGwa]) return { type: "ë¶ˆëª…", status: "normal", summary: "-" };
            const type = saengGiTable[myeongGwa][direction];
            const aiData = aiExplainBase[type] || { summary: "-", action: [], avoid: [], recommend: "-" };
            
            let status = 'bad';
            if (['ìƒê¸°','ì²œì˜','ë³µë•'].includes(type)) status = 'good';
            else if (['ìœ í˜¼','ê·€í˜¼','ì ˆì²´'].includes(type)) status = 'normal';
            
            return { type, status, ...aiData };
        }

        function changeMonth(offset) {
            viewDate.setMonth(viewDate.getMonth() + offset);
            renderCalendar();
        }

        function renderCalendar() {
            const container = document.getElementById('calendarContainer');
            const display = document.getElementById('currentMonthYearDisplay');
            if (!container) return;
            container.innerHTML = '';
            
            const year = viewDate.getFullYear();
            const month = viewDate.getMonth();
            display.innerText = `${year}ë…„ ${month + 1}ì›”`;

            const firstDay = new Date(year, month, 1).getDay();
            const lastDay = new Date(year, month + 1, 0).getDate();

            // ë¹ˆ ì¹¸ ì±„ìš°ê¸°
            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'day-cell bg-gray-50 opacity-40';
                container.appendChild(empty);
            }

            for (let d = 1; d <= lastDay; d++) {
                const dateObj = new Date(year, month, d);
                const direction = getDayDirection(dateObj);
                const fortune = isAnalyzed ? matchSaengGi(userData.myeongGwa, direction) : { type: "", status: "" };
                
                const cell = document.createElement('div');
                cell.className = `day-cell p-2 cursor-pointer flex flex-col justify-between border-r border-b`;
                
                if (isAnalyzed) {
                    const statusClass = fortune.status === 'good' ? 'good-day' : (fortune.status === 'normal' ? 'normal-day' : 'bad-day');
                    cell.classList.add(statusClass);
                }
                
                cell.innerHTML = `
                    <div class="flex justify-between items-start">
                        <span class="font-bold text-sm ${dateObj.getDay() === 0 ? 'text-red-500' : (dateObj.getDay() === 6 ? 'text-blue-500' : '')}">${d}</span>
                        <span class="text-[8px] opacity-40">${direction}</span>
                    </div>
                    <div class="text-[9px] font-bold text-center mb-1">${fortune.type || ""}</div>
                `;
                cell.onclick = () => showDetail(d, direction, fortune, dateObj);
                container.appendChild(cell);
            }
        }

        function showDetail(day, direction, fortune, dateObj) {
            if (!isAnalyzed || !fortune.type) return;
            const res = document.getElementById('analysisResult');
            res.classList.remove('hidden');
            const content = document.getElementById('reportContent');
            content.innerHTML = `
                <div class="p-4">
                    <h3 class="text-lg font-bold mb-4 border-b pb-2">ğŸ“œ ${dateObj.getFullYear()}ë…„ ${dateObj.getMonth()+1}ì›” ${day}ì¼ AI ìƒì„¸ ë¦¬í¬íŠ¸</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <p class="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1">ì˜¤ëŠ˜ì˜ ê¸°ìš´ [${direction}ë°©ìœ„]</p>
                                <div class="flex items-center gap-2">
                                    <span class="px-3 py-1 ${fortune.status === 'good' ? 'bg-emerald-600' : (fortune.status === 'bad' ? 'bg-rose-600' : 'bg-blue-600')} text-white rounded-full text-xs font-bold">${fortune.type}</span>
                                    <span class="text-sm font-medium text-gray-700">${fortune.summary}</span>
                                </div>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1">ì¶”ì²œ í™œë™</p>
                                <p class="text-sm text-indigo-700 font-bold">âœ¨ ${fortune.recommend}</p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-[10px] text-gray-500 font-bold mb-2">í–‰ë™ ì§€ì¹¨</p>
                                <div class="flex flex-wrap gap-2">
                                    ${fortune.action && fortune.action.length > 0 ? fortune.action.map(a => `<span class="bg-white border border-indigo-200 px-2 py-1 rounded text-[10px] text-indigo-600">#${a}</span>`).join('') : '<span class="text-[10px] text-rose-400 font-bold">#ìì¤‘ #íœ´ì‹</span>'}
                                </div>
                                ${fortune.avoid && fortune.avoid.length > 0 ? `<p class="mt-3 text-[10px] text-rose-500 font-bold">âš ï¸ ì£¼ì˜: ${fortune.avoid.join(', ')}</p>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            res.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function analyze() {
            const info = getUserBaseInfo();
            if (!info) return alert("ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.");
            
            userData = info;
            isAnalyzed = true;
            
            const display = document.getElementById('myeongGwaDisplay');
            if (display) display.innerText = `ë³¸ëª…ê´˜: ${userData.myeongGwa}ê´˜ (${userData.calendarType === 'lunar' ? 'ìŒë ¥' : 'ì–‘ë ¥'})`;
            
            renderCalendar();
            document.getElementById('analysisResult').classList.add('hidden');
        }

        window.onload = renderCalendar;
    </script>
</body>
</html>